<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>The CodingTool Library: allinone.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>allinone.cpp</h1><p>This is an example which shows how one can do all the stuff in one program, instead of splitting it up like in the other examples. Also it is shown how one can add his own parameters.</p>
<p>Again the SHA1 message expansion is used for demonstration.</p>
<div class="fragment"><pre class="fragment">
<span class="comment">// Copyright (c) 2010 Graz University of Technology (IAIK) &lt;http://www.iaik.tugraz.at&gt;</span>
<span class="comment">//  </span>
<span class="comment">// This file is part of the CodingTool.</span>
<span class="comment">//</span>
<span class="comment">// The CodingTool is free software: you can redistribute it and/or modify</span>
<span class="comment">// it under the terms of the GNU General Public License as published by</span>
<span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment">// (at your option) any later version.</span>
<span class="comment">//</span>
<span class="comment">// CodingTool is distributed in the hope that it will be useful,</span>
<span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment">// GNU General Public License for more details.</span>
<span class="comment">//</span>
<span class="comment">// You should have received a copy of the GNU General Public License</span>
<span class="comment">// along with CodingTool.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;cstdio&gt;</span>
<span class="preprocessor">#include &lt;cstdlib&gt;</span>
<span class="preprocessor">#include &lt;string&gt;</span>


<span class="preprocessor">#include &quot;<a class="code" href="_low_weight_search_8h.html" title="This is the header file of the class LowWeightSearch.">LowWeightSearch.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="_input_handler_8h.html" title="This is the header file of the class InputHandler.">InputHandler.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="types_8h.html" title="This file contains type definitions used through the library.">types.h</a>&quot;</span>

<span class="keyword">using namespace </span>std;

<span class="preprocessor"># define ROTR(w,x) ((((w) &amp; 0xFFFFFFFF) &gt;&gt; (x))|((w) &lt;&lt; (32 - (x))))</span>
<span class="preprocessor"></span>
<span class="preprocessor"># define ROTL(w,x) (((w) &lt;&lt; (x))|(((w) &amp; 0xFFFFFFFF) &gt;&gt; (32 - (x))))</span>
<span class="preprocessor"></span>
<a name="_a0"></a><a class="code" href="class_code_word.html" title="This class represents a binary code word.">CodeWord</a> BuildFunction(uint64_t &amp; dIter);
<span class="keywordtype">void</span> SHA1ME(uint32_t * m);

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* argv[]) {

        <span class="comment">// create an empty generator matrix</span>
        <a name="_a1"></a><a class="code" href="class_code_matrix.html" title="This class represents a binary code matrix.">CodeMatrix</a> oGenerator;
        <span class="comment">// create an empty code word</span>
        <a class="code" href="class_code_word.html" title="This class represents a binary code word.">CodeWord</a> oCodeWord;
        <span class="comment">// create parameters</span>
        <a name="_a2"></a><a class="code" href="class_parameters.html" title="This is a handler for parameters used in the CodingTool.">Parameters</a> oParameters;
        <span class="comment">// create an input handler</span>
        <a name="_a3"></a><a class="code" href="class_input_handler.html" title="This class handles the arguments from the command line interface.">InputHandler</a> oInputHandler(oParameters);
        <span class="comment">// create the low weight search object</span>
        <a name="_a4"></a><a class="code" href="class_low_weight_search.html" title="The main part of the CodingTool library.">LowWeightSearch</a> oLowWS;

        <span class="comment">// add a custom parameter</span>
        <span class="keywordtype">bool</span> bShortening = <span class="keyword">false</span>;
        oParameters.<a name="a5"></a><a class="code" href="class_parameters.html#a2ca8a9b2a1e34e8d5333430888685f37" title="Adds an integer parameter.">AddParameter</a>(<span class="stringliteral">&quot;-f&quot;</span>,0,<span class="stringliteral">&quot;enable code shortening&quot;</span>);

        <span class="comment">// parse the command line arguments</span>
        <span class="comment">// example: ./allinone -i 100 -o sha1me.cw -f 1</span>
        <span class="keywordflow">if</span>(oInputHandler.ParseSettings(argc, argv))
                exit(-1);

        bShortening = oParameters.<a name="a6"></a><a class="code" href="class_parameters.html#aed52535905bc429909096f2717e0d44c" title="Returns the value of an integer parameter.">GetIntegerParameter</a>(<span class="stringliteral">&quot;-f&quot;</span>);
                
        <span class="comment">// use the build function to create the generator matrix</span>
        <span class="comment">// for the last 60 words of the SHA1 m.e.</span>
        oGenerator.<a name="a7"></a><a class="code" href="class_code_matrix.html#aa4f385ad92e535cecc7bfbc464ae093c" title="Creates a code matrix.">Build</a>(&amp;BuildFunction,512);

        <span class="comment">// if shortening is enabled...</span>
        <span class="keywordflow">if</span>(bShortening) {
                vector&lt;uint64_t&gt; vForceZero;
                <span class="keywordflow">for</span>(uint32_t i = 0; i &lt; 32; i++)
                        vForceZero.push_back(oGenerator.<a name="a8"></a><a class="code" href="class_code_matrix.html#aa85ea1204aa95a1eebe5d13408fbc01b" title="Returns the number of columns.">GetColumns</a>()-32+i);
                oGenerator = <a name="a9"></a><a class="code" href="class_low_weight_search.html#aacb7e238efa82a8f81c865f8f1c4d96a" title="Forces specific columns of the given matrix to zero.">LowWeightSearch::CodeShortening</a>(oGenerator,vForceZero);
        }

        oCodeWord = oLowWS.<a name="a10"></a><a class="code" href="class_low_weight_search.html#acaaef1508ddc2e7e7f7e348ddc92ac3b" title="An algorithm to find code words with low Hamming weight.">CanteautChabaud</a>(oGenerator,oParameters);
        oCodeWord.<a name="a11"></a><a class="code" href="class_code_word.html#a72292ffe033e28f821f9b7173f5a8b76" title="Outputs the code word as 64-bit words.">Print64</a>();
        cout &lt;&lt; <span class="stringliteral">&quot;Hamming weight is &quot;</span> &lt;&lt; oCodeWord.<a name="a12"></a><a class="code" href="class_code_word.html#ac9a2ae29d2936b35e7f6da6243facbcd" title="Returns the Hamming weight of the code word.">GetHammingWeight</a>() &lt;&lt; endl;
        
        <span class="comment">// the last word should only be zero with &quot;-f 1&quot;</span>
        uint32_t m[60];
        <span class="keywordflow">for</span>(uint32_t j = 0; j&lt;16; j++)
                m[j] = oCodeWord.<a name="a13"></a><a class="code" href="class_code_word.html#a861911a2fe455000c52b60affc61012c" title="Returns the 32-bit word from the given position.">At32</a>(j);
        SHA1ME(m);
        
        cout &lt;&lt; <span class="stringliteral">&quot;last word = &quot;</span> &lt;&lt; m[59] &lt;&lt; endl;

        exit(1);
}

<a class="code" href="class_code_word.html" title="This class represents a binary code word.">CodeWord</a> BuildFunction(uint64_t &amp; i) {

        <a class="code" href="class_code_word.html" title="This class represents a binary code word.">CodeWord</a> oCodeWord;
        uint32_t m[60];
        uint32_t unitv = 1;

        <span class="comment">// 512 bit message block</span>
        <span class="keywordflow">for</span>(uint32_t j = 0; j&lt;16; j++)
                m[j] = 0;

        <span class="comment">// create i-th unit vector for the input</span>
        unitv = <a name="a14"></a><a class="code" href="allinone_8cpp.html#ab941ab89f8312d0a169b634f46255820" title="Rotate a 32-bit word to the right.">ROTR</a>(unitv , i+1);
        
        <span class="comment">// set input to i-th unit vector</span>
        m[i/32] = unitv;

        <span class="comment">// call the message expansion</span>
        SHA1ME(m);

        <span class="comment">// add message to the code</span>
        <span class="keywordflow">for</span>(uint32_t j = 0; j&lt;60; j++)
                oCodeWord.<a name="a15"></a><a class="code" href="class_code_word.html#a66f5770ffe69886cfc0d7999f1af42a1" title="Adds 32 bits at the end of the code word.">Push32</a>(m[j]);
        
        <span class="keywordflow">return</span> oCodeWord;
}


<span class="keywordtype">void</span> SHA1ME(uint32_t * m) {

        <span class="comment">// SHA-1 message expansion for the last 60 words</span>
        <span class="keywordflow">for</span>(uint32_t j = 16; j&lt;60; j++)
                m[j] = <a name="a16"></a><a class="code" href="allinone_8cpp.html#aa8bd1a79f3efc25cf131ceddf56e78ec" title="Rotate a 32-bit word to the left.">ROTL</a>((m[j-3] ^ m[j-8] ^ m[j-14] ^ m[j-16]),1);
}
</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Apr 23 11:23:11 2010 for The CodingTool Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
